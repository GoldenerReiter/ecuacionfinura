<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Gaucho Bot√°nico | El Alambique del Tropero</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Script preventivo para evitar el parpadeo de estilos (FOUC) -->
    <script>
        const savedTheme = localStorage.getItem('alambique_theme');
        if (savedTheme === 'light') {
            document.documentElement.classList.add('light-theme');
        }
    </script>

    <style>
        :root {
            /* DARK THEME (ESTADO NATURAL / POR DEFECTO) */
            --color-bg-base: #141614;
            --color-bg-card: #1C201D;
            --color-bg-sub: #252A26;
            --color-bg-panel: #0D0F0E;
            
            --color-text-main: #E2E0D5;
            --color-text-muted: #9BA39D;
            --color-text-panel: #E2E0D5;
            
            --color-accent-gold: #C2A878;
            --color-accent-brown: #D4A373;
            --color-danger: #EF4444;
            
            --color-border: #323A34;
            --color-nav-bg: rgba(20, 22, 20, 0.95);
            --color-btn-active: #2C352D;
        }

        html.light-theme {
            /* LIGHT THEME (MODO D√çA) */
            --color-bg-base: #F9F8F6;
            --color-bg-card: #FFFFFF;
            --color-bg-sub: #F0EFEA;
            --color-bg-panel: #1E2B22;
            
            --color-text-main: #1E2B22;
            --color-text-muted: #5A665A;
            --color-text-panel: #FFFFFF;
            
            --color-accent-gold: #C2A878;
            --color-accent-brown: #8B5A2B;
            --color-danger: #991B1B;
            
            --color-border: #EAE5D9;
            --color-nav-bg: rgba(249, 248, 246, 0.95);
            --color-btn-active: #1E2B22;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--color-bg-base);
            color: var(--color-text-main);
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.6' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        h1, h2, h3, .serif-font {
            font-family: 'Cormorant Garamond', serif;
        }

        /* App Container */
        .app-container {
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: 1fr;
            width: 100%;
            max-width: 800px;
            flex-grow: 1;
            margin: 0 auto;
            align-items: stretch;
            min-height: 0;
            position: relative;
        }

        /* Vistas (Tabs) */
        .tab-view {
            grid-column: 1;
            grid-row: 1;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 2rem;
            opacity: 0;
            visibility: hidden;
            transform: scale(0.98);
            transition: opacity 0.3s ease, transform 0.4s cubic-bezier(0.1, 0.9, 0.2, 1), visibility 0.4s;
            pointer-events: none;
            z-index: 1;
        }

        .tab-view::-webkit-scrollbar { width: 4px; }
        .tab-view::-webkit-scrollbar-track { background: transparent; }
        .tab-view::-webkit-scrollbar-thumb { background-color: rgba(194, 168, 120, 0.4); border-radius: 10px; }

        .tab-view.active {
            opacity: 1;
            visibility: visible;
            transform: scale(1);
            pointer-events: auto;
            z-index: 2;
        }

        /* Direcciones de animaci√≥n Swipe */
        .tab-view.from-left { transform: translateX(-30px); }
        .tab-view.from-right { transform: translateX(30px); }

        /* UI Elements */
        .card-elegant {
            background: var(--color-bg-card);
            border: 1px solid var(--color-border);
            box-shadow: 0 4px 20px -5px rgba(0,0,0,0.2);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        /* Calculadora App Styles */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        
        .calc-profile-btn {
            border: 1px solid var(--color-border);
            color: var(--color-text-muted);
            transition: all 0.2s ease;
            background: var(--color-bg-sub);
        }
        .calc-profile-btn.active {
            background-color: var(--color-btn-active);
            color: var(--color-accent-gold);
            border-color: var(--color-btn-active);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        .qty-btn {
            background: var(--color-bg-sub);
            color: var(--color-text-main);
            border: 1px solid var(--color-border);
            transition: all 0.2s;
            touch-action: manipulation;
        }
        .qty-btn:active {
            background: var(--color-accent-gold);
            color: #1E2B22;
            border-color: var(--color-accent-gold);
        }

        /* Bottom Nav */
        .bottom-nav {
            background: var(--color-nav-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-top: 1px solid var(--color-border);
            padding-bottom: env(safe-area-inset-bottom);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .nav-item {
            color: var(--color-text-muted);
            transition: all 0.2s ease;
        }
        .nav-item.active {
            color: var(--color-text-main);
        }
        .nav-item.active .icon-bg {
            background-color: var(--color-accent-gold);
            color: #1E2B22;
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(194, 168, 120, 0.4);
        }
        .nav-item .icon-bg {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--color-text-muted);
        }

        .dyn-val {
            color: var(--color-text-main);
            font-weight: 700;
            background: rgba(194, 168, 120, 0.15);
            padding: 0 4px;
            border-radius: 4px;
            border-bottom: 2px solid var(--color-accent-gold);
        }

        .terpene-card {
            border-left: 3px solid var(--color-accent-gold);
        }

        .elegant-table th {
            border-bottom: 2px solid var(--color-accent-gold);
            color: var(--color-text-main);
        }
        .elegant-table td {
            border-bottom: 1px solid var(--color-border);
        }
    </style>
</head>
<body class="h-[100dvh] w-screen overflow-hidden flex flex-col">

    <!-- Header Fijo con Bot√≥n de Tema -->
    <header class="w-full flex justify-center shrink-0 pt-4 pb-3 px-4 relative z-10" style="background: linear-gradient(to bottom, var(--color-bg-base) 60%, transparent);">
        <h1 class="serif-font text-2xl md:text-3xl font-bold tracking-wide text-[var(--color-text-main)]">
            <span class="text-[var(--color-accent-gold)] italic mr-1">El Alambique</span>del Tropero
        </h1>
        <button id="themeToggle" class="absolute right-4 top-4 text-xl p-2 rounded-full hover:bg-[var(--color-bg-sub)] transition-colors focus:outline-none" aria-label="Cambiar Tema">
            ‚òÄÔ∏è
        </button>
    </header>

    <!-- √ÅREA PRINCIPAL (Tabs Scrolleables) -->
    <main class="app-container px-3 sm:px-6" id="swipe-zone">
        
        <!-- VISTA 1: LA CALCULADORA -->
        <section class="tab-view active pt-2" id="view-0">
            <div class="text-center mb-4 md:mb-6">
                <p class="text-sm text-[var(--color-text-muted)] font-light max-w-md mx-auto">Elija el destino de su mateada o ajuste la carga a su gusto. El alambique le dictar√° la justa pal' yuyo.</p>
            </div>

            <div class="card-elegant rounded-xl relative p-3 sm:p-8 w-full">
                
                <h4 class="text-[10px] md:text-xs font-semibold uppercase tracking-widest text-[var(--color-accent-gold)] mb-3 ml-1">1. Seleccione la Cebadura</h4>
                
                <div class="grid grid-cols-5 gap-1.5 md:gap-2 mb-6">
                    <button class="calc-profile-btn active py-2 sm:py-3 px-0.5 rounded-lg text-[9px] sm:text-xs font-medium flex flex-col items-center justify-center gap-1.5" data-profile="puro">
                        <span class="text-lg md:text-xl">‚òÄÔ∏è</span> <span class="leading-tight text-center">Cimarr√≥n<br>Puro</span>
                    </button>
                    <button class="calc-profile-btn py-2 sm:py-3 px-0.5 rounded-lg text-[9px] sm:text-xs font-medium flex flex-col items-center justify-center gap-1.5" data-profile="rueda">
                        <span class="text-lg md:text-xl">üßâ</span> <span class="leading-tight text-center">Rueda<br>Matera</span>
                    </button>
                    <button class="calc-profile-btn py-2 sm:py-3 px-0.5 rounded-lg text-[9px] sm:text-xs font-medium flex flex-col items-center justify-center gap-1.5" data-profile="mitad">
                        <span class="text-lg md:text-xl">‚öñÔ∏è</span> <span class="leading-tight text-center">Mitad<br>y Mitad</span>
                    </button>
                    <button class="calc-profile-btn py-2 sm:py-3 px-0.5 rounded-lg text-[9px] sm:text-xs font-medium flex flex-col items-center justify-center gap-1.5" data-profile="mansa">
                        <span class="text-lg md:text-xl">üåô</span> <span class="leading-tight text-center">Noche<br>Mansa</span>
                    </button>
                    <button class="calc-profile-btn py-2 sm:py-3 px-0.5 rounded-lg text-[9px] sm:text-xs font-medium flex flex-col items-center justify-center gap-1.5" data-profile="custom">
                        <span class="text-lg md:text-xl">üßê</span> <span class="leading-tight text-center">A Ojo<br>de Cubero</span>
                    </button>
                </div>

                <hr class="border-t border-[var(--color-border)] mb-6">

                <h4 class="text-[10px] md:text-xs font-semibold uppercase tracking-widest text-[var(--color-accent-gold)] mb-3 ml-1">2. Pese la Materia Prima</h4>
                <div class="flex flex-col gap-4 mb-6">
                    <div class="flex items-center justify-between bg-[var(--color-bg-sub)] p-3 rounded-lg border border-[var(--color-border)]">
                        <div>
                            <span class="block text-sm font-semibold text-[var(--color-text-main)]">Flor Pura y Fresca</span>
                            <span class="text-[10px] text-[var(--color-text-muted)]">El esp√≠ritu vivo (Delta-9-THC)</span>
                        </div>
                        <div class="flex items-center shrink-0 shadow-sm">
                            <button class="qty-btn w-9 h-10 md:w-10 flex items-center justify-center font-bold rounded-l-md text-lg border-r-0" data-target="calc-flor" data-action="minus">‚àí</button>
                            <input type="number" id="calc-flor" class="w-12 md:w-14 h-10 text-center font-bold text-lg border-y border-[var(--color-border)] outline-none bg-[var(--color-bg-card)] text-[var(--color-text-main)]" value="10" min="0" step="0.5">
                            <button class="qty-btn w-9 h-10 md:w-10 flex items-center justify-center font-bold rounded-r-md text-lg border-l-0" data-target="calc-flor" data-action="plus">+</button>
                        </div>
                    </div>

                    <div class="flex items-center justify-between bg-[var(--color-bg-sub)] p-3 rounded-lg border border-[var(--color-border)]">
                        <div>
                            <span class="block text-sm font-semibold text-[var(--color-text-main)]">Fuerza del Yuyo (% THC)</span>
                            <span class="text-[10px] text-[var(--color-text-muted)]">Estimaci√≥n gen√©tica (Promedio 18%)</span>
                        </div>
                        <div class="flex items-center shrink-0 shadow-sm">
                            <button class="qty-btn w-9 h-10 md:w-10 flex items-center justify-center font-bold rounded-l-md text-lg border-r-0" data-target="calc-thc" data-action="minus">‚àí</button>
                            <input type="number" id="calc-thc" class="w-12 md:w-14 h-10 text-center font-bold text-lg border-y border-[var(--color-border)] outline-none bg-[var(--color-bg-card)] text-[var(--color-accent-brown)]" value="18" min="0" max="35">
                            <button class="qty-btn w-9 h-10 md:w-10 flex items-center justify-center font-bold rounded-r-md text-lg border-l-0" data-target="calc-thc" data-action="plus">+</button>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between bg-[var(--color-bg-sub)] p-3 rounded-lg border border-[var(--color-border)]">
                        <div>
                            <span class="block text-sm font-semibold text-[var(--color-text-main)]">Chirca Tostada (AVB)</span>
                            <span class="text-[10px] text-[var(--color-accent-brown)]">Flor vapeada. Aporta pesadez (CBN)</span>
                        </div>
                        <div class="flex items-center shrink-0 shadow-sm">
                            <button class="qty-btn w-9 h-10 md:w-10 flex items-center justify-center font-bold rounded-l-md text-lg border-r-0" data-target="calc-avb" data-action="minus">‚àí</button>
                            <input type="number" id="calc-avb" class="w-12 md:w-14 h-10 text-center font-bold text-lg border-y border-[var(--color-border)] outline-none bg-[var(--color-bg-card)] text-[var(--color-text-muted)]" value="0" min="0" step="0.5">
                            <button class="qty-btn w-9 h-10 md:w-10 flex items-center justify-center font-bold rounded-r-md text-lg border-l-0" data-target="calc-avb" data-action="plus">+</button>
                        </div>
                    </div>
                </div>

                <div class="bg-[var(--color-bg-panel)] rounded-xl p-5 shadow-inner text-[var(--color-text-panel)] relative overflow-hidden">
                    <div class="absolute -right-4 -top-4 opacity-10 text-7xl text-[var(--color-text-panel)]">‚öñÔ∏è</div>
                    <h4 class="text-[10px] font-semibold uppercase tracking-widest text-[var(--color-accent-gold)] mb-4">La Balanza del Boticario</h4>
                    
                    <div class="grid grid-cols-2 gap-y-5 gap-x-2 relative z-10">
                        <div>
                            <span class="block text-[10px] opacity-60 mb-0.5">Grasa Necesaria (Ghee crudo)</span>
                            <span class="text-2xl font-bold"><span id="res-ghee">150</span> <span class="text-sm font-normal">g</span></span>
                        </div>
                        <div>
                            <span class="block text-[10px] opacity-60 mb-0.5">Potencia por Bocado</span>
                            <span class="text-2xl font-bold text-[var(--color-accent-gold)]"><span id="res-mg">33</span> <span class="text-sm font-normal">mg p/ porci√≥n</span></span>
                        </div>
                        <div class="col-span-2 bg-black/30 p-3 rounded-lg border-l-2 border-[var(--color-accent-gold)] flex justify-between items-center">
                            <div class="pr-2">
                                <span class="block text-[9px] opacity-50 uppercase tracking-widest mb-0.5">Perfil de Viaje Estimado</span>
                                <span class="text-[11px] sm:text-sm font-medium text-[var(--color-accent-gold)] leading-tight block" id="res-dose">Dosis Recreativa Fuerte</span>
                            </div>
                            <div class="text-right pl-2 border-l border-[var(--color-text-panel)] opacity-80 shrink-0">
                                <span class="block text-[9px] opacity-60 uppercase tracking-widest mb-0.5">Cortes Asadera</span>
                                <span class="text-xl font-bold"><span id="res-cuadros">40</span> <span class="text-xs font-normal">u</span></span>
                            </div>
                        </div>
                    </div>
                </div>

                <button id="btnGoToRecipe" class="w-full mt-4 bg-[var(--color-accent-gold)] text-[#1E2B22] font-bold py-3 rounded-lg shadow-md flex items-center justify-center gap-2 hover:opacity-90 transition-opacity text-sm">
                    Ir al Fog√≥n (Preparaci√≥n) <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                </button>

            </div>
        </section>

        <!-- VISTA 2: PREPARACI√ìN DIN√ÅMICA -->
        <section class="tab-view pt-2" id="view-1">
            <div class="text-center mb-4">
                <h2 class="serif-font text-3xl text-[var(--color-text-main)] mb-1">El Fog√≥n del Boticario</h2>
                <p class="text-xs text-[var(--color-accent-gold)] uppercase tracking-widest">El Ritual Paso a Paso</p>
            </div>

            <!-- Comentario Tem√°tico Din√°mico del Alambique -->
            <div class="mb-5 bg-[var(--color-bg-sub)] border border-[var(--color-border)] p-3 rounded-lg text-center shadow-sm relative overflow-hidden">
                <span class="absolute -left-2 -top-2 opacity-10 text-4xl">üßâ</span>
                <p id="dyn-message" class="text-sm text-[var(--color-accent-brown)] font-medium italic relative z-10 leading-relaxed font-serif">
                    <!-- Text injected by JS -->
                </p>
            </div>

            <div class="space-y-4">
                
                <!-- PASO 1: Descarboxilaci√≥n -->
                <div class="card-elegant p-5 rounded-xl">
                    <div class="flex items-center gap-3 mb-3 border-b border-[var(--color-border)] pb-3">
                        <div class="w-8 h-8 rounded-full bg-[var(--color-btn-active)] text-[var(--color-accent-gold)] flex items-center justify-center font-bold font-serif">1</div>
                        <h3 class="serif-font text-2xl text-[var(--color-text-main)] leading-none">El Despertar del Yuyo</h3>
                    </div>
                    
                    <p class="text-sm text-[var(--color-text-muted)] leading-relaxed">
                        Agarre sus <span class="dyn-val" id="dyn-flor">10</span> <strong class="text-[var(--color-text-main)]">gramos de Flor Pura</strong> y p√≠quelos mansito, sin hacerlos polvo. √âchelos en una asadera y t√°pela con plomo (papel aluminio) pa' atrapar el aroma, igual que se tapa el mate pa' que no se enfr√≠e la yerba.
                    </p>
                    <div class="mt-3 bg-[var(--color-bg-sub)] p-3 rounded text-sm border border-[var(--color-border)] text-[var(--color-text-main)]">
                        Al horno manso a <span class="dyn-val" id="dyn-temp">110¬∞C</span> por <strong>40 minutitos</strong> pa' que el THC despierte.
                        <span class="block text-[10px] text-[var(--color-danger)] mt-1 italic">*Atenci√≥n: No apure el fuego. Si pasa los 160¬∞C, quema el yuyo como yerba hervida.</span>
                    </div>

                    <!-- El Reloj del Horno con Sonido -->
                    <div class="mt-4 bg-[var(--color-bg-panel)] p-3 rounded-lg flex items-center justify-between shadow-inner border border-[var(--color-accent-gold)] border-opacity-50">
                        <div class="flex items-center gap-3">
                            <span class="text-2xl text-[var(--color-text-panel)] opacity-80">‚è≥</span>
                            <div>
                                <span class="block text-[9px] text-[var(--color-text-panel)] opacity-60 uppercase tracking-widest">Reloj del Horno</span>
                                <span class="text-xl font-bold text-[var(--color-accent-gold)] font-mono tracking-wider" id="timer-display">40:00</span>
                            </div>
                        </div>
                        <button id="btn-timer" class="bg-[var(--color-accent-gold)] text-[#1E2B22] px-4 py-2 rounded font-bold text-[11px] uppercase tracking-wider hover:opacity-90 transition-all shadow-md">
                            Iniciar
                        </button>
                    </div>

                </div>

                <!-- PASO 2: Infusi√≥n -->
                <div class="card-elegant p-5 rounded-xl">
                    <div class="flex items-center gap-3 mb-3 border-b border-[var(--color-border)] pb-3">
                        <div class="w-8 h-8 rounded-full bg-[var(--color-btn-active)] text-[var(--color-accent-gold)] flex items-center justify-center font-bold font-serif">2</div>
                        <h3 class="serif-font text-2xl text-[var(--color-text-main)] leading-none">El Ba√±o de Oro Verde</h3>
                    </div>
                    
                    <p class="text-sm text-[var(--color-text-muted)] leading-relaxed mb-3">
                        En un frasco al ba√±o mar√≠a, acomode los <span class="dyn-val" id="dyn-ghee">150</span> <strong class="text-[var(--color-text-main)]">gramos de Ghee crudo</strong>. 
                        <br><br>
                        Vuelque la flor reci√©n horneada <span id="dyn-avb-section" class="hidden">y p√≥ngale los <span class="dyn-val" style="border-color: var(--color-accent-brown); color: var(--color-accent-brown)" id="dyn-avb">0</span> <strong class="text-[var(--color-accent-brown)]">gramos de Chirca Tostada (AVB)</strong> pal' peso</span>.
                    </p>
                    <ul class="text-sm text-[var(--color-text-muted)] space-y-2 mt-2 list-disc pl-4">
                        <li><strong>El Agua:</strong> Entre 75¬∞C y 85¬∞C. Como el agua pal' mate, que chifle bajito pero que no hierva a borbotones.</li>
                        <li><strong>El Tiempo:</strong> Deje la infusi√≥n 3 a 4 horitas, revolviendo suave cada rato.</li>
                        <li><strong>El Colado:</strong> Pase por gasa doble. <strong class="text-[var(--color-text-main)]">¬°No estruje la tela!</strong> Deje gotear, o le va a quedar un amargor fiero a clorofila.</li>
                    </ul>
                    <div class="mt-3 text-sm font-semibold bg-[var(--color-bg-sub)] text-[var(--color-accent-gold)] p-2 rounded text-center border border-[var(--color-accent-gold)]">
                        Rendimiento de su alquimia: <span class="dyn-val" id="dyn-yield">129</span> gramos de Oro Verde netos.
                    </div>
                </div>

                <!-- PASO 3: Asadera Final -->
                <div class="card-elegant p-5 rounded-xl">
                    <div class="flex items-center gap-3 mb-3 border-b border-[var(--color-border)] pb-3">
                        <div class="w-8 h-8 rounded-full bg-[var(--color-btn-active)] text-[var(--color-accent-gold)] flex items-center justify-center font-bold font-serif">3</div>
                        <h3 class="serif-font text-2xl text-[var(--color-text-main)] leading-none">La Partici√≥n del Bizcocho</h3>
                    </div>
                    
                    <p class="text-sm text-[var(--color-text-muted)] leading-relaxed mb-3">
                        Arme la masa de sus bocados usando los <span class="dyn-val" id="dyn-yield2">129</span> <strong class="text-[var(--color-text-main)]">gramos de Oro Verde</strong>. 
                        Mande la asadera al horno, pero vigile que <strong class="text-[var(--color-danger)]">no pase los 160¬∞C ambientales</strong>, pa' no matar el milagro.
                    </p>
                    
                    <div class="bg-[var(--color-bg-panel)] text-[var(--color-text-panel)] p-4 rounded-lg mt-2 relative overflow-hidden">
                        <div class="absolute right-0 bottom-0 opacity-10">
                            <svg width="60" height="60" viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h16v16H4V4zm2 2v12h12V6H6zm2 2h3v3H8V8zm5 0h3v3h-3V8zm-5 5h3v3H8v-3zm5 0h3v3h-3v-3z"/></svg>
                        </div>
                        <p class="text-xs uppercase tracking-widest text-[var(--color-accent-gold)] mb-2 relative z-10">La Matem√°tica del Paisano</p>
                        <p class="text-sm mb-2 relative z-10">Pa' que cada bocado tenga sus redondos <strong class="text-[var(--color-accent-gold)] dyn-val px-1 rounded bg-black/30 border-none" id="dyn-mg">33</strong><strong class="text-[var(--color-accent-gold)]">mg de sustancia</strong>, usted tiene que cortar el molde fr√≠o en:</p>
                        <p class="text-3xl font-serif text-[var(--color-accent-gold)] relative z-10"><span id="dyn-cuadros">40</span> <span class="text-lg font-sans opacity-80">pedazos parejitos.</span></p>
                    </div>
                </div>

            </div>
        </section>

        <!-- VISTA 3: LA ESCALA Y LOS TERPENOS -->
        <section class="tab-view pt-2" id="view-2">
            <div class="text-center mb-6">
                <h2 class="serif-font text-3xl text-[var(--color-text-main)] mb-1">Ciencia y Arquetipos</h2>
                <p class="text-[10px] md:text-xs text-[var(--color-accent-gold)] uppercase tracking-widest">El Saber del Yuyo y la Grasa</p>
            </div>

            <!-- Tabla de Perfiles Farmacol√≥gicos -->
            <div class="card-elegant rounded-xl mb-4 overflow-hidden">
                <div class="bg-[var(--color-bg-panel)] text-[var(--color-accent-gold)] text-xs uppercase tracking-widest font-semibold p-3 text-center border-b border-[var(--color-accent-gold)] opacity-90">
                    Espectro de la Cebadura (Fuerza en mg)
                </div>
                <div class="overflow-x-auto w-full">
                    <table class="elegant-table min-w-[550px]">
                        <thead>
                            <tr class="bg-[var(--color-bg-sub)] text-[var(--color-text-muted)] text-xs uppercase tracking-wider">
                                <th class="p-3">Categor√≠a del Viaje</th>
                                <th class="p-3">Rango (THC)</th>
                                <th class="p-3">Perfil de Efecto</th>
                            </tr>
                        </thead>
                        <tbody class="text-sm">
                            <tr class="hover:bg-[var(--color-bg-sub)] transition-colors">
                                <td class="p-3 border-b border-[var(--color-border)]">
                                    <strong class="text-[var(--color-text-main)] block mb-0.5">Pa' barrer el patio silbando</strong>
                                    <span class="text-[10px] text-[var(--color-text-muted)]">Microdosis</span>
                                </td>
                                <td class="p-3 text-[var(--color-text-main)] font-medium border-b border-[var(--color-border)]"><span class="text-[var(--color-accent-gold)] font-bold">1 - 5</span> mg</td>
                                <td class="p-3 text-[var(--color-text-muted)] leading-tight border-b border-[var(--color-border)]">Te deja m√°s despierto que tero en descampado. Ideal pa' matear tempranito y encarar la jornada con un chiflido manso y mente clara.</td>
                            </tr>
                            <tr class="hover:bg-[var(--color-bg-sub)] transition-colors">
                                <td class="p-3 border-b border-[var(--color-border)]">
                                    <strong class="text-[var(--color-text-main)] block mb-0.5">Alegr√≠a pa' la ronda</strong>
                                    <span class="text-[10px] text-[var(--color-text-muted)]">Dosis Terap√©utica / Social</span>
                                </td>
                                <td class="p-3 text-[var(--color-text-main)] font-medium border-b border-[var(--color-border)]"><span class="text-[var(--color-accent-gold)] font-bold">5 - 15</span> mg</td>
                                <td class="p-3 text-[var(--color-text-muted)] leading-tight border-b border-[var(--color-border)]">Lengua suelta y risa f√°cil. Alegr√≠a mansa ideal pa' arreglar el mundo en rueda o filosofar mirando las brasas de la estufa sin perderse.</td>
                            </tr>
                            <tr class="hover:bg-[var(--color-bg-sub)] transition-colors">
                                <td class="p-3 border-b border-[var(--color-border)]">
                                    <strong class="text-[var(--color-text-main)] block mb-0.5">Se le pierde el caballo...</strong>
                                    <span class="text-[10px] text-[var(--color-text-muted)]">Dosis Fuerte (Recreativa)</span>
                                </td>
                                <td class="p-3 text-[var(--color-text-main)] font-medium border-b border-[var(--color-border)]"><span class="text-[var(--color-accent-gold)] font-bold">15 - 30</span> mg</td>
                                <td class="p-3 text-[var(--color-text-muted)] leading-tight border-b border-[var(--color-border)]">Las piernas se te hacen de plomo dulce. Especial pa' quedarse en el catre contemplando el techo largo y tendido. Viaje intenso.</td>
                            </tr>
                            <tr class="hover:bg-[var(--color-bg-sub)] transition-colors">
                                <td class="p-3">
                                    <strong class="text-[var(--color-accent-brown)] block mb-0.5">Ve a Artigas en pantuflas</strong>
                                    <span class="text-[10px] text-[var(--color-text-muted)]">Patada de Mula (Heroica)</span>
                                </td>
                                <td class="p-3 text-[var(--color-text-main)] font-medium"><span class="text-[var(--color-danger)] font-bold">> 30</span> mg</td>
                                <td class="p-3 text-[var(--color-text-muted)] leading-tight">Te aploma contra la silla. El morfeo criollo lo va a tapar con poncho grueso y ni el trueno del temporal lo levanta antes de tiempo.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Aclaraci√≥n del Boticario -->
            <div class="card-elegant p-4 rounded-xl mb-6 bg-[var(--color-bg-sub)] border-l-4 border-l-[var(--color-accent-brown)] relative overflow-hidden">
                <div class="absolute -right-2 -bottom-2 opacity-10 text-5xl">üßê</div>
                <p class="text-sm text-[var(--color-text-main)] leading-relaxed relative z-10">
                    <strong class="text-[var(--color-accent-brown)]">¬°Atenci√≥n paisano!</strong> No confunda el tipo de yuyo con la patada. 
                    <br><br>
                    Su elecci√≥n arriba en "El Alambique" (Cimarr√≥n, Noche Mansa) le da el <strong>color del viaje</strong> (m√°s despierto o m√°s dormido seg√∫n el AVB). Pero la <strong>fuerza real (los miligramos)</strong> se la dan los gramos totales que ust√© le eche a la olla. ¬°Para eso es la M√°quina!
                </p>
            </div>

            <!-- LOS ESP√çRITUS DEL YUYO (Terpenos) -->
            <div class="card-elegant p-5 rounded-xl mb-4">
                <h4 class="serif-font text-2xl text-[var(--color-text-main)] mb-3 border-b border-[var(--color-border)] pb-2 flex items-center gap-2">
                    <span class="text-xl">üå¨Ô∏è</span> Los Esp√≠ritus del Yuyo
                </h4>
                <p class="text-xs text-[var(--color-text-muted)] mb-4 text-justify">
                    Si ust√© le erra a la temperatura del horno, la planta le cobra peaje evaporando su esencia (los terpenos). Aqu√≠ tiene la lista de los esp√≠ritus, a qu√© temperatura levantan vuelo, y el responso criollo pa' cuando los pierde por andar apurado:
                </p>

                <div class="space-y-4">
                    <div class="terpene-card bg-[var(--color-bg-sub)] p-3 rounded-r-lg border border-[var(--color-border)] border-l-0 relative overflow-hidden">
                        <div class="flex justify-between items-start mb-1">
                            <strong class="text-[var(--color-text-main)] text-sm flex items-center gap-1">üå≤ Pineno</strong>
                            <span class="text-xs font-bold text-[var(--color-accent-brown)]">Fuga: 155¬∞C</span>
                        </div>
                        <p class="text-[11px] text-[var(--color-text-muted)] mb-2">Da foco y olor a le√±a de monte verde.</p>
                        <p class="text-xs italic text-[var(--color-text-main)] font-serif">"Se te fue el olor a monte, paisano; te qued√≥ el mate lavado y la mente en la niebla."</p>
                    </div>

                    <div class="terpene-card bg-[var(--color-bg-sub)] p-3 rounded-r-lg border border-[var(--color-border)] border-l-0 relative overflow-hidden">
                        <div class="flex justify-between items-start mb-1">
                            <strong class="text-[var(--color-text-main)] text-sm flex items-center gap-1">üåø Mirceno</strong>
                            <span class="text-xs font-bold text-[var(--color-accent-brown)]">Fuga: 167¬∞C</span>
                        </div>
                        <p class="text-[11px] text-[var(--color-text-muted)] mb-2">Relaja el cuerpo, huele a tierra h√∫meda tras la lluvia.</p>
                        <p class="text-xs italic text-[var(--color-text-main)] font-serif">"Vol√≥ el reposo pa' los huesos. Ahora a aguantar el tir√≥n sin colch√≥n de plumas."</p>
                    </div>

                    <div class="terpene-card bg-[var(--color-bg-sub)] p-3 rounded-r-lg border border-[var(--color-border)] border-l-0 relative overflow-hidden">
                        <div class="flex justify-between items-start mb-1">
                            <strong class="text-[var(--color-text-main)] text-sm flex items-center gap-1">üçã Limoneno</strong>
                            <span class="text-xs font-bold text-[var(--color-accent-brown)]">Fuga: 176¬∞C</span>
                        </div>
                        <p class="text-[11px] text-[var(--color-text-muted)] mb-2">Levanta el √°nimo, chispa c√≠trica.</p>
                        <p class="text-xs italic text-[var(--color-text-main)] font-serif">"Se te escap√≥ la risa f√°cil por la chimenea; qued√≥ el yuyo amargo y sin gracia."</p>
                    </div>

                    <div class="terpene-card bg-[var(--color-bg-sub)] p-3 rounded-r-lg border border-[var(--color-border)] border-l-0 relative overflow-hidden">
                        <div class="flex justify-between items-start mb-1">
                            <strong class="text-[var(--color-text-main)] text-sm flex items-center gap-1">ü™ª Linalool</strong>
                            <span class="text-xs font-bold text-[var(--color-accent-brown)]">Fuga: 198¬∞C</span>
                        </div>
                        <p class="text-[11px] text-[var(--color-text-muted)] mb-2">Floral y manso, es el sedante por excelencia.</p>
                        <p class="text-xs italic text-[var(--color-text-main)] font-serif">"Arrebataste hasta la flor m√°s resistente. No hay sue√±o parejo que te salve hoy."</p>
                    </div>
                </div>
            </div>

            <!-- Bloque Cient√≠fico Farmacocin√©tico -->
            <div class="card-elegant p-5 rounded-xl mb-4">
                <h4 class="serif-font text-2xl text-[var(--color-text-main)] mb-3 border-b border-[var(--color-border)] pb-2 flex items-center gap-2">
                    <span class="text-xl">üß¨</span> Metabolismo del Paisano
                </h4>
                
                <div class="space-y-4 text-sm text-[var(--color-text-muted)] leading-relaxed text-justify">
                    <div>
                        <strong class="text-[var(--color-text-main)] block mb-1">El H√≠gado y el 11-OH-THC</strong>
                        Al comer el yuyo, el h√≠gado del gaucho convierte el Delta-9-THC en <em>11-Hidroxi-THC</em>. Este metabolito cruza al cerebro como caballo sin freno, por eso el bocado pega m√°s fuerte y dura m√°s horas que una pitada de humo.
                    </div>
                    <div>
                        <strong class="text-[var(--color-text-main)] block mb-1">El Abrazo de la Grasa (Ghee)</strong>
                        El THC es amigo de las grasas. El Ghee, al no tener agua, atrapa casi el 75-80% de la fuerza del yuyo. En "La M√°quina", calculamos exacto cu√°nta grasa precisa la yerba pa' no desperdiciar nada:
                        <div class="bg-[var(--color-bg-sub)] p-2 mt-2 rounded border border-[var(--color-border)] text-center">
                            <code class="text-[10px] font-bold text-[var(--color-accent-brown)]">Miligramos = (Gramos Flor √ó 1000) √ó (% THC √∑ 100) √ó 0.75</code>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- VISTA 4: EL LORE (ALMANAQUE Y REFERENCIAS) -->
        <section class="tab-view pt-2" id="view-3">
            <div class="text-center mb-6">
                <h2 class="serif-font text-3xl text-[var(--color-text-main)] mb-1">El Almanaque</h2>
                <p class="text-[10px] md:text-xs text-[var(--color-accent-gold)] uppercase tracking-widest">Sabidur√≠a Oriental y Ciencia</p>
            </div>

            <!-- El Poema -->
            <div class="card-elegant p-6 sm:p-10 rounded-xl mb-6 text-center relative overflow-hidden">
                <div class="absolute inset-0 opacity-5 pointer-events-none" style="background-image: url('https://images.unsplash.com/photo-1528698827591-e19ccd7bc23d?auto=format&fit=crop&q=80'); background-size: cover; background-position: center;"></div>
                
                <h3 class="serif-font text-3xl text-[var(--color-text-main)] mb-6 relative z-10">D√©cimas de la Rueda Matera</h3>
                
                <div class="text-[var(--color-text-muted)] text-[15px] leading-relaxed font-light space-y-5 italic relative z-10">
                    <p>
                        Asiente el mate, mi amigo, y escuche con atenci√≥n,<br>
                        que pa‚Äô lograr buen viaje no basta con la intenci√≥n.<br>
                        Si el verde es fino y curado, y el Ghee pide su destino,<br>
                        oiga bien estas palabras... que le marcan el camino.
                    </p>
                    <p>
                        Igual que el agua pal' mate, que nunca debe hervir,<br>
                        no me arrebate ese horno si al yuyo quiere exprimir.<br>
                        Ciento diez son los graditos, ni uno m√°s pa' no quemar,<br>
                        que si el Limoneno vuela... no lo vuelve a recuperar.
                    </p>
                    <p>
                        Al ba√±o mar√≠a la cosa, paciencia de cebador,<br>
                        que el verde suelte su alma y la grasa tome el sabor.<br>
                        Cuele con trapo de lino, sin apretar con malicia,<br>
                        que el oro verde que queda... sea una suave caricia.
                    </p>
                    <p>
                        A ciento sesenta la masa, pa' cuidar toda la esencia,<br>
                        que el secreto del buen viaje... es tener mucha prudencia.<br>
                        Muerda un solo pedacito, y espere que el sol se ponga,<br>
                        que este yuyo no perdona... ¬°si usted me lo rezonga!
                    </p>
                </div>
            </div>

            <!-- Referencias Cient√≠ficas -->
            <div class="p-5 border border-[var(--color-accent-gold)]/30 rounded-xl bg-[var(--color-bg-sub)] relative">
                <div class="absolute -top-3 left-4 bg-[var(--color-bg-sub)] px-2 rounded">
                    <h4 class="text-xs uppercase tracking-widest font-semibold text-[var(--color-accent-brown)]">Pergaminos de los Doctores</h4>
                </div>
                <p class="text-[11px] text-[var(--color-text-muted)] mb-3 mt-1 italic">
                    La cencia del "Alambique del Tropero" no es puro cuento de boliche; se apoya firme en los siguientes tratados acad√©micos:
                </p>
                <ul class="space-y-3 text-[10px] md:text-xs text-[var(--color-text-muted)] leading-relaxed">
                    <li class="pl-3 border-l border-[var(--color-accent-gold)]">
                        <strong class="text-[var(--color-text-main)]">Huestis, M. A. (2007).</strong> <em>Human Cannabinoid Pharmacokinetics</em>. Chemistry & Biodiversity. (Explica la paliza metab√≥lica del h√≠gado y el 11-OH-THC).
                    </li>
                    <li class="pl-3 border-l border-[var(--color-accent-gold)]">
                        <strong class="text-[var(--color-text-main)]">Wang, M., et al. (2016).</strong> <em>Decarboxylation Study of Acidic Cannabinoids...</em> Cannabis and Cannabinoid Research. (Valida la regla de oro de los 110¬∞C pa' despertar la flor).
                    </li>
                    <li class="pl-3 border-l border-[var(--color-accent-gold)]">
                        <strong class="text-[var(--color-text-main)]">Zuurman, L., et al. (2008).</strong> <em>Effect of intrapulmonary, oral, and sublingual administration...</em> Clinical Pharmacology. (Fundamenta la pesadez del CBN del yuyo ya vapeado).
                    </li>
                </ul>
            </div>

            <div class="text-center mt-6 pb-2 opacity-50">
                <p class="text-[10px] uppercase tracking-widest text-[var(--color-text-muted)]">MVD ‚Ä¢ URUGUAY ‚Ä¢ 2026</p>
            </div>
        </section>

    </main>

    <!-- BOTTOM NAVIGATION (App Style) -->
    <nav class="bottom-nav w-full shrink-0 flex justify-around items-center px-2 py-2 pb-4 z-20">
        <button class="nav-item active flex flex-col items-center gap-1 w-1/4 pt-1 idx-btn" data-target="0">
            <div class="icon-bg w-10 h-8 rounded-full flex items-center justify-center text-xl bg-[var(--color-accent-gold)] text-[#1E2B22] shadow-sm">‚öñÔ∏è</div>
            <span class="text-[10px] font-semibold tracking-wide mt-0.5">Alambique</span>
        </button>
        <button class="nav-item flex flex-col items-center gap-1 w-1/4 pt-1 idx-btn" data-target="1">
            <div class="icon-bg w-10 h-8 rounded-full flex items-center justify-center text-xl text-[var(--color-text-muted)]">üßâ</div>
            <span class="text-[10px] font-semibold tracking-wide mt-0.5">El Fog√≥n</span>
        </button>
        <button class="nav-item flex flex-col items-center gap-1 w-1/4 pt-1 idx-btn" data-target="2">
            <div class="icon-bg w-10 h-8 rounded-full flex items-center justify-center text-xl text-[var(--color-text-muted)]">üåø</div>
            <span class="text-[10px] font-semibold tracking-wide mt-0.5">El Saber</span>
        </button>
        <button class="nav-item flex flex-col items-center gap-1 w-1/4 pt-1 idx-btn" data-target="3">
            <div class="icon-bg w-10 h-8 rounded-full flex items-center justify-center text-xl text-[var(--color-text-muted)]">üìú</div>
            <span class="text-[10px] font-semibold tracking-wide mt-0.5">Lore</span>
        </button>
    </nav>

    <script>
        /* -----------------------------------------------------------------
           L√ìGICA DEL TEMA (DARK / LIGHT MODE)
        ----------------------------------------------------------------- */
        const themeBtn = document.getElementById('themeToggle');
        const htmlTag = document.documentElement;

        function updateThemeIcon() {
            if (htmlTag.classList.contains('light-theme')) {
                themeBtn.textContent = 'üåô';
            } else {
                themeBtn.textContent = '‚òÄÔ∏è';
            }
        }
        
        updateThemeIcon();

        themeBtn.addEventListener('click', () => {
            if (htmlTag.classList.contains('light-theme')) {
                htmlTag.classList.remove('light-theme');
                localStorage.setItem('alambique_theme', 'dark');
            } else {
                htmlTag.classList.add('light-theme');
                localStorage.setItem('alambique_theme', 'light');
            }
            updateThemeIcon();
        });

        /* -----------------------------------------------------------------
           L√ìGICA DEL SONIDO DE CAMPANA (WEB AUDIO API)
        ----------------------------------------------------------------- */
        function playAlarmSound() {
            try {
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                
                function playCampanita(time, freq) {
                    const osc = audioCtx.createOscillator();
                    const gainNode = audioCtx.createGain();
                    
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(freq, time);
                    
                    gainNode.gain.setValueAtTime(0, time);
                    gainNode.gain.linearRampToValueAtTime(0.8, time + 0.05);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, time + 1.5);
                    
                    osc.connect(gainNode);
                    gainNode.connect(audioCtx.destination);
                    
                    osc.start(time);
                    osc.stop(time + 1.5);
                }
                
                // Dos campanadas suaves
                playCampanita(audioCtx.currentTime, 880); 
                playCampanita(audioCtx.currentTime + 0.4, 880); 
            } catch (e) {
                console.log("El audio no est√° soportado en este navegador.");
            }
        }

        /* -----------------------------------------------------------------
           L√ìGICA DEL RELOJ DEL HORNO (TEMPORIZADOR)
        ----------------------------------------------------------------- */
        let timerInterval;
        let timeRemaining = 40 * 60; // 40 minutos en segundos
        let isTimerRunning = false;
        
        const timerDisplay = document.getElementById('timer-display');
        const btnTimer = document.getElementById('btn-timer');

        function formatTime(seconds) {
            const m = Math.floor(seconds / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            return `${m}:${s}`;
        }

        btnTimer.addEventListener('click', () => {
            if (isTimerRunning) {
                // Pausar
                clearInterval(timerInterval);
                isTimerRunning = false;
                btnTimer.textContent = 'Reanudar';
                btnTimer.classList.remove('bg-[var(--color-danger)]', 'text-white');
                btnTimer.classList.add('bg-[var(--color-accent-gold)]', 'text-[#1E2B22]');
            } else {
                // Iniciar o Reanudar
                isTimerRunning = true;
                btnTimer.textContent = 'Pausar';
                btnTimer.classList.remove('bg-[var(--color-accent-gold)]', 'text-[#1E2B22]');
                btnTimer.classList.add('bg-[var(--color-danger)]', 'text-white');
                
                timerInterval = setInterval(() => {
                    if (timeRemaining > 0) {
                        timeRemaining--;
                        timerDisplay.textContent = formatTime(timeRemaining);
                    } else {
                        // Termin√≥
                        clearInterval(timerInterval);
                        isTimerRunning = false;
                        btnTimer.textContent = '¬°Pronto!';
                        btnTimer.classList.remove('bg-[var(--color-danger)]', 'text-white');
                        btnTimer.classList.add('bg-[#1E2B22]', 'text-[var(--color-accent-gold)]');
                        
                        // Sonido del alambique
                        playAlarmSound();
                        
                        // Un peque√±o delay para que el sonido empiece antes del alert bloqueante
                        setTimeout(() => {
                            alert("¬°Atento paisano! Ya pasaron los 40 minutos. Saque esa asadera del horno antes de que se le evaporen los esp√≠ritus.");
                        }, 100);
                        
                        // Reset autom√°tico despu√©s de avisar
                        setTimeout(() => {
                            timeRemaining = 40 * 60;
                            timerDisplay.textContent = formatTime(timeRemaining);
                            btnTimer.textContent = 'Iniciar';
                            btnTimer.classList.remove('bg-[#1E2B22]', 'text-[var(--color-accent-gold)]');
                            btnTimer.classList.add('bg-[var(--color-accent-gold)]', 'text-[#1E2B22]');
                        }, 5000);
                    }
                }, 1000);
            }
        });


        /* -----------------------------------------------------------------
           L√ìGICA DE NAVEGACI√ìN (TABS Y SWIPE)
        ----------------------------------------------------------------- */
        const views = document.querySelectorAll('.tab-view');
        const navItems = document.querySelectorAll('.nav-item');
        let currentTab = 0;
        const totalTabs = views.length;
        let isAnimating = false;

        function switchTab(targetIndex) {
            if (isAnimating || targetIndex === currentTab) return;
            isAnimating = true;
            
            let direction = targetIndex > currentTab ? 'next' : 'prev';
            currentTab = targetIndex;

            // Actualizar interfaz de botones de navegaci√≥n inferor
            navItems.forEach((btn, idx) => {
                const iconBg = btn.querySelector('.icon-bg');
                if (idx === currentTab) {
                    btn.classList.add('active');
                    iconBg.classList.replace('text-[var(--color-text-muted)]', 'text-[#1E2B22]');
                    iconBg.classList.add('bg-[var(--color-accent-gold)]', 'shadow-sm');
                } else {
                    btn.classList.remove('active');
                    iconBg.classList.remove('text-[#1E2B22]', 'text-white');
                    iconBg.classList.add('text-[var(--color-text-muted)]');
                    iconBg.classList.remove('bg-[var(--color-accent-gold)]', 'shadow-sm');
                }
            });

            // Animar Vistas
            views.forEach((view, index) => {
                view.classList.remove('active', 'from-left', 'from-right');
                
                if (index === currentTab) {
                    view.scrollTop = 0; 
                    if (direction === 'next') {
                        view.classList.add('from-right');
                        void view.offsetWidth; 
                        view.classList.remove('from-right');
                    } else {
                        view.classList.add('from-left');
                        void view.offsetWidth; 
                        view.classList.remove('from-left');
                    }
                    view.classList.add('active');
                }
            });

            setTimeout(() => { isAnimating = false; }, 400);
        }

        // Event listener seguro por ID
        const btnGoToRecipe = document.getElementById('btnGoToRecipe');
        if (btnGoToRecipe) {
            btnGoToRecipe.addEventListener('click', () => {
                switchTab(1);
            });
        }

        navItems.forEach((btn) => {
            btn.addEventListener('click', () => {
                switchTab(parseInt(btn.dataset.target));
            });
        });

        // Swipe Logic
        let touchStartX = 0;
        let touchStartY = 0;
        const swipeZone = document.getElementById('swipe-zone');
        let blockSwipe = false;

        swipeZone.addEventListener('touchstart', e => {
            if (e.target.tagName.toLowerCase() === 'input' || e.target.tagName.toLowerCase() === 'button') {
                blockSwipe = true;
                return;
            }
            const scrollableParent = e.target.closest('.overflow-x-auto');
            if (scrollableParent && scrollableParent.scrollWidth > scrollableParent.clientWidth) {
                blockSwipe = true;
                return;
            }
            blockSwipe = false;
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        }, {passive: true});

        swipeZone.addEventListener('touchend', e => {
            if (blockSwipe) return;
            
            let touchEndX = e.changedTouches[0].screenX;
            let touchEndY = e.changedTouches[0].screenY;
            
            const diffX = touchStartX - touchEndX;
            const diffY = touchStartY - touchEndY;
            
            if (Math.abs(diffY) > Math.abs(diffX) || Math.abs(diffX) < 50) return;

            if (diffX > 0 && currentTab < totalTabs - 1) {
                switchTab(currentTab + 1); 
            } else if (diffX < 0 && currentTab > 0) {
                switchTab(currentTab - 1); 
            }
        }, {passive: true});


        /* -----------------------------------------------------------------
           L√ìGICA DE LA M√ÅQUINA (CALCULADORA & AUTO-PERFIL POR PROPORCI√ìN)
        ----------------------------------------------------------------- */
        const profiles = {
            puro:   { flor: 10, avb: 0, thc: 18, temp: "110¬∞C" },
            rueda:  { flor: 8,  avb: 2, thc: 18, temp: "110¬∞C" },
            mitad:  { flor: 5,  avb: 5, thc: 18, temp: "115¬∞C" },
            mansa:  { flor: 2,  avb: 8, thc: 18, temp: "118¬∞C" },
            custom: { flor: null, avb: null, thc: null, temp: "115¬∞C" }
        };

        const profileNames = {
            puro: "Cimarr√≥n Puro",
            rueda: "Rueda Matera",
            mitad: "Mitad y Mitad",
            mansa: "Noche Mansa",
            custom: "A Ojo de Cubero"
        };

        const profileMessages = {
            puro: "¬´Atento el paisano, que esta mezcla es pa' salir al alba m√°s despierto que tero en descampado. Pura chispa y nada de modorra. Cuide el fuego, que ac√° est√° destilando ingenio oriental.¬ª",
            rueda: "¬´Armando la ronda, aparcero. Esta medida es pa' que la charla fluya mansa como arroyo de llanura. Ni lo apura ni lo duerme; el equilibrio justo pa' filosofar sin apuro.¬ª",
            mitad: "¬´Mitad vuelo, mitad ancla. Con esto va a quedar m√°s manso que carpincho tomando sol en la orilla. Especial pa' escuchar el crujir de la le√±a y dejar que el tiempo pase de largo.¬ª",
            mansa: "¬´Buscando la almohada temprano, ¬øeh? Este menjunje tiene m√°s peso que poncho de lana mojado. Cocine con respeto, que el morfeo criollo no avisa cuando pega el tir√≥n.¬ª",
            custom: "¬´Mezclando a ojo de buen cubero, como oriental que no le gusta que le manden. El alambique no juzga sus medidas, pero anote bien la receta por si descubre un nuevo milagro.¬ª"
        };

        let activeProfile = 'puro';
        const inputFlor = document.getElementById('calc-flor');
        const inputThc = document.getElementById('calc-thc');
        const inputAvb = document.getElementById('calc-avb');
        
        function getDoseCategory(mg) {
            if (mg === 0) return "Agua tibia (Ni cosquillas)";
            if (mg < 5) return "Pa' barrer el patio silbando";
            if (mg <= 15) return "Alegr√≠a pa' aguantar la ronda";
            if (mg <= 30) return "Se le pierde el caballo al gaucho";
            return "Va a ver a Artigas en pantuflas";
        }

        function updateCalculations(autoMatchProfile = true) {
            let flor = parseFloat(inputFlor.value);
            if(isNaN(flor) || flor < 0) { flor = 0; inputFlor.value = 0; }
            
            let thc = parseFloat(inputThc.value);
            if(isNaN(thc) || thc < 0) { thc = 0; inputThc.value = 0; }
            
            let avb = parseFloat(inputAvb.value);
            if(isNaN(avb) || avb < 0) { avb = 0; inputAvb.value = 0; }
            
            // Inteligencia de proporci√≥n
            if (autoMatchProfile) {
                let matchedProfile = 'custom';
                const totalMateria = flor + avb;
                
                if (totalMateria > 0) {
                    const ratioFlor = flor / totalMateria;
                    if (ratioFlor >= 0.9) matchedProfile = 'puro';
                    else if (ratioFlor >= 0.65) matchedProfile = 'rueda';
                    else if (ratioFlor >= 0.35) matchedProfile = 'mitad';
                    else matchedProfile = 'mansa';
                }

                if (activeProfile !== matchedProfile) {
                    activeProfile = matchedProfile;
                    document.querySelectorAll('.calc-profile-btn').forEach(b => b.classList.remove('active'));
                    const activeBtn = document.querySelector(`.calc-profile-btn[data-profile="${activeProfile}"]`);
                    if(activeBtn) activeBtn.classList.add('active');
                }
            }

            // F√≥rmulas
            const ghee = Math.round((flor * 15) + (avb * 9.375));
            const yieldGhee = Math.round(ghee * 0.86);
            const cuadros = Math.round((flor * 4) + (avb * 2.5)) || 1;
            
            const mgFlor = (flor * 1000) * (thc / 100) * 0.75;
            const residualThcAvb = (thc / 100) * 0.15; 
            const mgAvb = (avb * 1000) * residualThcAvb * 0.40;
            
            const totalMg = mgFlor + mgAvb;
            const mgPerCut = Math.round(totalMg / cuadros);

            const temp = profiles[activeProfile].temp;
            
            // UI Alambique
            document.getElementById('res-ghee').textContent = `${ghee}`;
            document.getElementById('res-mg').textContent = `${mgPerCut}`;
            document.getElementById('res-cuadros').textContent = cuadros > 0 ? `${cuadros}` : '0';
            document.getElementById('res-dose').textContent = `${profileNames[activeProfile]} - ${getDoseCategory(mgPerCut)}`;
            
            // UI Fog√≥n
            document.getElementById('dyn-flor').textContent = flor;
            document.getElementById('dyn-temp').textContent = temp;
            document.getElementById('dyn-ghee').textContent = ghee;
            document.getElementById('dyn-yield').textContent = yieldGhee;
            document.getElementById('dyn-yield2').textContent = yieldGhee;
            document.getElementById('dyn-cuadros').textContent = cuadros > 0 ? `${cuadros}` : '0';
            document.getElementById('dyn-mg').textContent = mgPerCut;
            
            // Comentario din√°mico
            document.getElementById('dyn-message').textContent = profileMessages[activeProfile];
            
            const avbSection = document.getElementById('dyn-avb-section');
            if (avb > 0) {
                avbSection.classList.remove('hidden');
                document.getElementById('dyn-avb').textContent = avb;
            } else {
                avbSection.classList.add('hidden');
            }

            const dynVals = document.querySelectorAll('.dyn-val');
            dynVals.forEach(el => {
                el.style.backgroundColor = 'rgba(194, 168, 120, 0.4)';
                setTimeout(() => { el.style.backgroundColor = 'rgba(194, 168, 120, 0.15)'; }, 300);
            });
        }

        // Clicks en perfiles superiores
        document.querySelectorAll('.calc-profile-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.calc-profile-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                activeProfile = btn.dataset.profile;
                
                if (activeProfile !== 'custom') {
                    inputFlor.value = profiles[activeProfile].flor;
                    inputAvb.value = profiles[activeProfile].avb;
                    inputThc.value = profiles[activeProfile].thc;
                }
                
                updateCalculations(false);
            });
        });

        inputFlor.addEventListener('input', () => updateCalculations(true));
        inputAvb.addEventListener('input', () => updateCalculations(true));
        inputThc.addEventListener('input', () => updateCalculations(true));

        document.querySelectorAll('.qty-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const targetId = btn.dataset.target;
                const action = btn.dataset.action;
                const input = document.getElementById(targetId);
                let val = parseFloat(input.value) || 0;
                let step = parseFloat(input.getAttribute('step')) || 1;
                
                if (action === 'plus') val += step;
                if (action === 'minus' && val >= step) val -= step;
                
                input.value = parseFloat(val.toFixed(1));
                updateCalculations(true);
            });
        });

        // Inicializar m√°quina
        updateCalculations(true);
    </script>
</body>
</html>